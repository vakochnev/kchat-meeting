# KChat Meeting ‚Äî –ë–æ—Ç –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Å–æ–≤–µ—â–∞–Ω–∏–π

–ë–æ—Ç –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ KChat. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å —Å–æ–≤–µ—â–∞–Ω–∏—è–º–∏: —Å–æ–∑–¥–∞–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞–º–∏ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, —Å–±–æ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î (SQLite / PostgreSQL), –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ ‚Äî —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã, inline-–∫–Ω–æ–ø–∫–∏ –∏ Server-Sent Events.

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Docker](#—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ-–≤-docker)
- [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
- [–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞](#–∫–æ–º–∞–Ω–¥—ã-–±–æ—Ç–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–≤–µ—â–∞–Ω–∏–π](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-—Å–æ–≤–µ—â–∞–Ω–∏–π)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#–ø–∞—Ç—Ç–µ—Ä–Ω—ã-–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- [–û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π](#–æ–ø–∏—Å–∞–Ω–∏–µ-–º–æ–¥—É–ª–µ–π)
- [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
- [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
- [–ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–∑–Ω–∏ –±–æ—Ç–∞ (Health Check)](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–∂–∏–∑–Ω–∏-–±–æ—Ç–∞-health-check)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#–ª–∏—Ü–µ–Ω–∑–∏—è)

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–≤–µ—â–∞–Ω–∏—è–º–∏:** —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–µ—Ä–µ–Ω–æ—Å —Å–æ–±—Ä–∞–Ω–∏–π —á–µ—Ä–µ–∑ –ø–æ—à–∞–≥–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.
- **–ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ:** –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –ø–æ–∏—Å–∫ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–±—Ä–∞–Ω–∏–µ; —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ / –Ω–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏); –ø–∞–≥–∏–Ω–∞—Ü–∏—è.
- **–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏:** —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–∞–∂–¥–æ–µ –Ω–æ–≤–æ–µ —Å–æ–±—Ä–∞–Ω–∏–µ.
- **–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ:** –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏ (–î–∞ / –ù–µ—Ç / –ë–æ–ª—å–Ω–∏—á–Ω—ã–π / –ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞ / –û—Ç–ø—É—Å–∫).
- **SSE-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** —Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ KChat –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- **Health Check:** —Å–∫—Ä–∏–ø—Ç-–∑–æ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∂–¥—ë—Ç —ç—Ö–æ ‚Äî –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ cron / Docker HEALTHCHECK.
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –¥–∞—Ç—ã —Å–æ–±—Ä–∞–Ω–∏—è –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (weekly / daily).
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ):** —Ä–∞—Å—Å—ã–ª–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π —á–µ—Ä–µ–∑ KChat / e-mail / SMS.

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- [uv](https://github.com/astral-sh/uv) ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ Python

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ uv

```bash
# Linux/macOS
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windows
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd kchat-meeting
uv sync
```

> –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `messenger_bot_api` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ wheel –≤ `libs/`.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```ini
BOT_TOKEN=your_bot_token_here
API_BASE_URL=https://api.kchat.app
SSE_BASE_URL=https://pusher.kchat.app
DATABASE_URL=sqlite:///meeting.db
LOG_LEVEL=INFO
```

### 4. –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```bash
uv run alembic upgrade head
uv run python tools/seed_meeting_admins.py
```

### 5. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —á—Ç–æ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ (dry-run)
uv run python tools/seed_permanent_invited.py --file config/permanent_invited.txt --dry-run

# –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞
uv run python tools/seed_permanent_invited.py --file config/permanent_invited.txt

# –ó–∞–≥—Ä—É–∑–∫–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
uv run python tools/seed_permanent_invited.py --file config/permanent_invited.txt --update
```

–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ `config/permanent_invited.txt`:
```
# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #
# –§–æ—Ä–º–∞—Ç: –§–ò–û | email | —Ç–µ–ª–µ—Ñ–æ–Ω (—Ç–µ–ª–µ—Ñ–æ–Ω –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω)
# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏: ' | ', '|', ';'
–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á | ivanov@example.com | +79991234567
–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á | petrov@example.com
–°–∏–¥–æ—Ä–æ–≤ –°.–°.;sidorov@example.com;+79997654321
```

### 6. –ó–∞–ø—É—Å–∫

```bash
uv run python main.py
```

---

## –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Docker

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker, Docker Compose
- –í–Ω–µ—à–Ω—è—è –ë–î (PostgreSQL) ‚Äî —É–∫–∞–∂–∏—Ç–µ `DATABASE_URL`

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env`

```ini
BOT_TOKEN=your_bot_token_here
DATABASE_URL=postgresql://user:password@host:5432/meeting
API_BASE_URL=https://api.kchat.app
SSE_BASE_URL=https://pusher.kchat.app
```

–î–ª—è –ë–î –Ω–∞ —Ç–æ–º –∂–µ —Ö–æ—Å—Ç–µ (Linux) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `host.docker.internal` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `docker-compose.yml`:

```yaml
extra_hosts:
  - "host.docker.internal:host-gateway"
```

### 2. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```ini
# –°–ø–∏—Å–æ–∫ email —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π
MEETING_ADMINS=admin1@company.ru;admin2@company.ru

# –ò–ª–∏ —Å –§–ò–û: full_name|email
MEETING_ADMINS=–ò–≤–∞–Ω–æ–≤ –ò.–ò.|admin1@company.ru;–ü–µ—Ç—Ä–æ–≤ –ü.–ü.|admin2@company.ru

# –õ–∏–±–æ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É (—Ñ–æ—Ä–º–∞—Ç: –§–ò–û | email | phone)
MEETING_ADMINS_FILE=/app/config/meeting_admins.txt
```

### 3. –ó–∞–ø—É—Å–∫

```bash
docker compose up -d --build
```

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è: –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic ‚Üí seed `meeting_admins` ‚Üí –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞.

### 4. –õ–æ–≥–∏ –≤ —Ñ–∞–π–ª

```ini
LOG_FILE=/app/logs/bot.log
```

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ volume `kchat-meeting-logs`.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| `BOT_TOKEN` | –î–∞ | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ KChat |
| `DATABASE_URL` | –ù–µ—Ç | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `sqlite:///meeting.db`) |
| `API_BASE_URL` | –ù–µ—Ç | URL API KChat (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `https://api.kchat.app`) |
| `SSE_BASE_URL` | –ù–µ—Ç | URL SSE (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `https://pusher.kchat.app`) |
| `LOG_LEVEL` | –ù–µ—Ç | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤ (INFO, DEBUG –∏ —Ç.–¥.) |
| `LOG_FILE` | –ù–µ—Ç | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ |
| `MEETING_ADMINS` | –ù–µ—Ç | –°–ø–∏—Å–æ–∫ email –∞–¥–º–∏–Ω–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ |
| `MEETING_ADMINS_FILE` | –ù–µ—Ç | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å–æ —Å–ø–∏—Å–∫–æ–º –∞–¥–º–∏–Ω–æ–≤ |
| `HEALTH_CHECK_GROUP_ID` | –î–∞* | ID –≥—Ä—É–ø–ø—ã –¥–ª—è health check |
| `HEALTH_CHECK_WORKSPACE_ID` | –ù–µ—Ç | ID workspace (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -1) |
| `HEALTH_CHECK_TIMEOUT` | –ù–µ—Ç | –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è —ç—Ö–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10) |
| `INVITED_PER_PAGE` | –ù–µ—Ç | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10) |
| `SMTP_HOST` | –ù–µ—Ç | SMTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `SMTP_PORT` | –ù–µ—Ç | –ü–æ—Ä—Ç SMTP |
| `SMTP_USER` | –ù–µ—Ç | –õ–æ–≥–∏–Ω SMTP |
| `SMTP_PASSWORD` | –ù–µ—Ç | –ü–∞—Ä–æ–ª—å SMTP |
| `SMTP_SENDER` | –ù–µ—Ç | Email –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è |
| `EMAIL_TEMPLATE_PATH` | –ù–µ—Ç | –ü—É—Ç—å –∫ —à–∞–±–ª–æ–Ω—É email |

*–î–ª—è health check –Ω—É–∂–µ–Ω `HEALTH_CHECK_GROUP_ID`.

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|---------|----------|--------|
| `/start` | –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ | –í—Å–µ |
| `/–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è`, `/meeting` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–±—Ä–∞–Ω–∏–∏ (–¥–∞—Ç–∞, –≤—Ä–µ–º—è, –º–µ—Å—Ç–æ) | –í—Å–µ |
| `/–ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ` | –°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –Ω–∞ —Ç–µ–∫—É—â–µ–µ —Å–æ–±—Ä–∞–Ω–∏–µ | –ê–¥–º–∏–Ω |
| `/–Ω–µ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏` | –ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ –±–µ–∑ –æ—Ç–º–µ—Ç–∫–∏ | –ê–¥–º–∏–Ω |
| `/–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏` | –ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ —Å –æ—Ç–º–µ—Ç–∫–æ–π | –ê–¥–º–∏–Ω |
| `/—É—á–∞—Å—Ç–Ω–∏–∫–∏` | –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | –ê–¥–º–∏–Ω |
| `/—Å–æ–±—Ä–∞–Ω–∏–µ`, `—Å–æ–±—Ä–∞–Ω–∏–µ` | –ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—Ä–∞–Ω–∏–µ–º | –ê–¥–º–∏–Ω |
| `/—Å–æ–∑–¥–∞—Ç—å_—Å–æ–±—Ä–∞–Ω–∏–µ`, `/create_meeting` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–±—Ä–∞–Ω–∏–µ | –ê–¥–º–∏–Ω |
| `/–æ—Ç–ø—Ä–∞–≤–∏—Ç—å` | –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ) | –ê–¥–º–∏–Ω |
| `/–æ—Ç–º–µ–Ω–∞`, `/cancel` | –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –¥–∏–∞–ª–æ–≥ | –í—Å–µ |
| `/–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å`, `/skip` | –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —à–∞–≥ –≤ –¥–∏–∞–ª–æ–≥–µ | –í—Å–µ |
| `/–ø–æ–º–æ—â—å`, `/help` | –°–ø—Ä–∞–≤–∫–∞ | –í—Å–µ |
| `/–≤—Å–µ` | –ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ –±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è) | –ê–¥–º–∏–Ω |
| `/2`, `/3`, ... | –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É N (–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è) | –ê–¥–º–∏–Ω |

–ö–æ–º–∞–Ω–¥—ã `/–≤—Å–µ` –∏ `/N` ‚Äî **–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ**: –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö, –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—ã–∑–≤–∞–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ.

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–≤–µ—â–∞–Ω–∏–π

### –°–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞

JSON-—Ñ–∞–π–ª `config/meeting.json` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–Ω–æ–ø–æ–∫:

```json
{
  "messages": {
    "greeting": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!\n\n–§–ò–û: {fio}",
    "welcome": "üìÖ –í—ã –ø—Ä–∏–≥–ª–∞—à–µ–Ω—ã –Ω–∞ —Å–æ–≤–µ—â–∞–Ω–∏–µ.\n\n–§–ò–û: {fio}\n\n–ü–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ª–∏ –≤—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å?",
    "not_allowed": "‚ùå –í—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö...",
    "help": "üìñ **–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É —Å–æ–≤–µ—â–∞–Ω–∏–π**...",
    "help_admin": "üìñ **–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É —Å–æ–≤–µ—â–∞–Ω–∏–π (–¥–ª—è –∞–¥–º–∏–Ω–∞)**..."
  },
  "buttons": {
    "yes": { "id": 1, "label": "‚úÖ –î–∞, –±—É–¥—É –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å", "callback_data": "meeting_yes" },
    "no": { "id": 2, "label": "‚ùå –ù–µ—Ç, –Ω–µ —Å–º–æ–≥—É –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å", "callback_data": "meeting_no" },
    "no_sick": { "id": 3, "label": "‚ùå –ù–µ—Ç (–ë–æ–ª—å–Ω–∏—á–Ω—ã–π)", "callback_data": "meeting_no_sick" },
    "no_business_trip": { "id": 4, "label": "‚ùå –ù–µ—Ç (–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞)", "callback_data": "meeting_no_business_trip" },
    "no_vacation": { "id": 5, "label": "‚ùå –ù–µ—Ç (–û—Ç–ø—É—Å–∫)", "callback_data": "meeting_no_vacation" }
  }
}
```

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Å–æ–±—Ä–∞–Ω–∏–π

YAML-—Ñ–∞–π–ª `config/meeting_settings.yml`:

```yaml
meetings:
  - schedule:
      type: "weekly"        # weekly | daily | cron (cron –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
      day_of_week: 0        # 0=–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ ... 6=–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
      time: "11:00"
    topic: "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–¥–µ–ª–∏"
    place: ""               # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    link: ""                # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `permanent_invited` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–∞–∂–¥–æ–µ –Ω–æ–≤–æ–µ —Å–æ–±—Ä–∞–Ω–∏–µ –ø—Ä–∏ –µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏–∏.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   HTTP/SSE    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  KChat API   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ     BotApp       ‚îÇ
‚îÇ  KChat SSE   ‚îÇ               ‚îÇ  (modules/core)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                        ‚îÇ
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ               ‚îÇ               ‚îÇ
                   message_handler  callback_handler  sse_handler
                        ‚îÇ               ‚îÇ               ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                        ‚îÇ
                               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                               ‚îÇ MeetingHandler   ‚îÇ
                               ‚îÇ  (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)   ‚îÇ
                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ       ‚îÇ       ‚îÇ       ‚îÇ          ‚îÇ
                   CommandResolver  InvitedHandler  ParticipantsHandler
                   CommandDispatcher  UserContextStore  MeetingService
                                                            ‚îÇ
                                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                    ‚îÇ       ‚îÇ       ‚îÇ
                                              MeetingRepo  UserRepo  MeetingStorage
                                                    ‚îÇ
                                                ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê
                                                ‚îÇ  DB   ‚îÇ
                                                ‚îÇSQLAlchemy‚îÇ
                                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
kchat-meeting/
‚îú‚îÄ‚îÄ main.py                         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py                       # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (dataclass + .env)
‚îú‚îÄ‚îÄ requirements.txt                # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ
‚îú‚îÄ‚îÄ config/                         # –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ meeting.json                # –¢–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–Ω–æ–ø–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ meeting_settings.yml        # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Å–æ–±—Ä–∞–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ permanent_invited.txt       # –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö (seed)
‚îÇ
‚îú‚îÄ‚îÄ api/                            # HTTP-–∫–ª–∏–µ–Ω—Ç KChat API
‚îÇ   ‚îî‚îÄ‚îÄ users.py                    # get_user_info() ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ
‚îú‚îÄ‚îÄ db/                             # –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ models.py                   # SQLAlchemy –º–æ–¥–µ–ª–∏ (User, Meeting, Invited, ...)
‚îÇ   ‚îú‚îÄ‚îÄ session.py                  # Engine, SessionFactory, init_db()
‚îÇ   ‚îî‚îÄ‚îÄ user_repository.py          # UserRepository ‚Äî CRUD –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã users
‚îÇ
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ core/                       # –Ø–¥—Ä–æ –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.py                  # BotApp ‚Äî –∑–∞–ø—É—Å–∫, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, SSE-–ø–æ—Ç–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sse_handler.py          # SSEHandler ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SSE
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health_check_responder.py  # –≠—Ö–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ meeting/                    # –ú–æ–¥—É–ª—å —Å–æ–≤–µ—â–∞–Ω–∏–π (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler.py              # MeetingHandler ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command_resolver.py     # CommandResolver ‚Äî —Ä–∞–∑–±–æ—Ä —Ç–µ–∫—Å—Ç–∞ ‚Üí –∫–æ–º–∞–Ω–¥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command_dispatcher.py   # CommandDispatcher ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_context.py         # UserContextStore ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ invited_handler.py      # InvitedHandler ‚Äî –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ participants_handler.py # ParticipantsHandler ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ invited_parser.py       # –ü–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ (–§–ò–û | email | —Ç–µ–ª.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service.py              # MeetingService ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ meeting_repository.py   # MeetingRepository ‚Äî CRUD —Å–æ–±—Ä–∞–Ω–∏–π –∏ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage.py              # MeetingStorage ‚Äî —Ä–∞–±–æ—Ç–∞ —Å Invited (–æ—Ç–≤–µ—Ç—ã)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config_manager.py       # MeetingConfigManager ‚Äî JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.py           # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schedule_utils.py       # –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –¥–∞—Ç—ã —Å–æ–±—Ä–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_meeting_flow.py  # –ü–æ—à–∞–≥–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Ä–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ edit_meeting_flow.py    # –ü–æ—à–∞–≥–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add_invited_flow.py     # –î–∏–∞–ª–æ–≥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ edit_delete_invited_flow.py    # –î–∏–∞–ª–æ–≥ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search_invited_flow.py         # –î–∏–∞–ª–æ–≥ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add_permanent_invited_flow.py  # –î–∏–∞–ª–æ–≥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ edit_delete_permanent_invited_flow.py  # –î–∏–∞–ª–æ–≥ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ search_permanent_invited_flow.py       # –î–∏–∞–ª–æ–≥ –ø–æ–∏—Å–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ answers/                    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–∏–ø–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ (Strategy)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py                 # AnswerHandler ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ yes_no.py               # YesNoAnswerHandler
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ choice.py               # –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π/–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ text.py                 # –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rating.py               # –®–∫–∞–ª–∞/—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ dispatcher/                 # –û–±—â–∏–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä (–¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π)
‚îÇ       ‚îî‚îÄ‚îÄ dispatcher.py
‚îÇ
‚îú‚îÄ‚îÄ tools/                          # CLI-—É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ bot_health_check.py         # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–∑–Ω–∏ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ seed_meeting_admins.py      # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ seed_permanent_invited.py   # –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö
‚îÇ
‚îú‚îÄ‚îÄ alembic/                        # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ alembic.ini
‚îÇ   ‚îú‚îÄ‚îÄ env.py
‚îÇ   ‚îî‚îÄ‚îÄ versions/                   # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ
‚îú‚îÄ‚îÄ libs/                           # –õ–æ–∫–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ messenger_bot_api-*.whl     # SDK –¥–ª—è KChat Bot API
‚îÇ
‚îî‚îÄ‚îÄ docs/
    ‚îî‚îÄ‚îÄ REFACTORING_PLAN_HANDLER.md # –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ handler.py
```

---

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Command + Dispatcher (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥)

**–§–∞–π–ª—ã:** `command_resolver.py`, `command_dispatcher.py`

–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –¥–≤–∞ —ç—Ç–∞–ø–∞:
- **CommandResolver** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç *—á—Ç–æ* –∑–∞ –∫–æ–º–∞–Ω–¥–∞: –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`/–ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ`, `/2`, `/–≤—Å–µ`) –≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (`"invited"`, `"invited_page"`, `"participants_all"`). –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (—É—á–∞—Å—Ç–Ω–∏–∫–∏ vs. –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ) –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã —Å–æ–±—ã—Ç–∏—è (`_page_number`, `_filter_type`).
- **CommandDispatcher** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç *–æ–±—Ä–∞–±–æ—Ç—á–∏–∫* –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `command ‚Üí callable`. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã = –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –≤ `register()`.

```python
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
d.register("invited", self._cmd_invited)
d.register("participants", self._cmd_participants)

# –í—ã–∑–æ–≤
self._dispatcher.dispatch(event, command)
```

### 2. Delegate / SRP (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏)

**–§–∞–π–ª—ã:** `invited_handler.py`, `participants_handler.py`

`MeetingHandler` (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä) –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤, –∫–Ω–æ–ø–æ–∫ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏. –ö–∞–∂–¥–∞—è –ø—Ä–µ–¥–º–µ—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–ª–∞—Å—Å–µ:
- `InvitedHandler` ‚Äî –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ –Ω–∞ —Å–æ–±—Ä–∞–Ω–∏–µ (–ø–æ–∫–∞–∑, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –∫–Ω–æ–ø–∫–∏, add/delete/search).
- `ParticipantsHandler` ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (–ø–æ–∫–∞–∑, –ø–∞–≥–∏–Ω–∞—Ü–∏—è, –∫–Ω–æ–ø–∫–∏, add/delete/search).

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (Dependency Injection).

### 3. State / Context Store (—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)

**–§–∞–π–ª:** `user_context.py`

`UserContextStore` —Ö—Ä–∞–Ω–∏—Ç –¥–≤–∞ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ `sender_id`:
- `participants_context: bool` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–ø–∏—Å–∫–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
- `filter_context: Optional[str]` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö (`"voted"`, `"not_voted"`, `None`).

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º (`/2`, `/–≤—Å–µ`) —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ: —Å–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –∏–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.

### 4. Strategy (—Ç–∏–ø—ã –æ—Ç–≤–µ—Ç–æ–≤)

**–§–∞–π–ª—ã:** `modules/answers/base.py`, `yes_no.py`, `choice.py`, `text.py`, `rating.py`

–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å `AnswerHandler` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
- `validate(question, value)` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞.
- `format_value(question, value)` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
- `build_buttons(question, question_id)` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è inline-–∫–Ω–æ–ø–æ–∫.
- `expects_text_input()` ‚Äî –æ–∂–∏–¥–∞–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥.

–ö–∞–∂–¥—ã–π —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞ (–¥–∞/–Ω–µ—Ç, –≤—ã–±–æ—Ä, —Ç–µ–∫—Å—Ç, —Ä–µ–π—Ç–∏–Ω–≥) —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.

### 5. Repository (–¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º)

**–§–∞–π–ª—ã:** `meeting_repository.py`, `db/user_repository.py`, `storage.py`

–í—Å—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö:
- `MeetingRepository` ‚Äî CRUD –¥–ª—è `Meeting`, `Invited`, `PermanentInvited`, `MeetingAdmin`.
- `UserRepository` ‚Äî CRUD –¥–ª—è `User`.
- `MeetingStorage` ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ `Invited` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤).

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `get_session_context()` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º `commit/rollback`.

### 6. Flow (–ø–æ—à–∞–≥–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏)

**–§–∞–π–ª—ã:** `create_meeting_flow.py`, `edit_meeting_flow.py`, `add_invited_flow.py` –∏ –¥—Ä.

–ö–∞–∂–¥—ã–π Flow ‚Äî –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç –¥–∏–∞–ª–æ–≥–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:
- –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ –∫–ª—é—á—É `(sender_id, group_id, workspace_id)`.
- –ú–µ—Ç–æ–¥—ã: `start(event)`, `process(event, text, ...)`, `cancel(event)`, `is_active(event)`.
- `MeetingHandler` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ flow –ø–µ—Ä–µ–¥ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥—ã.

–¢–∞–±–ª–∏—Ü–∞ –æ—Ç–º–µ–Ω—ã `_cancel_table` —Å–≤—è–∑—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π flow —Å –¥–µ–π—Å—Ç–≤–∏–µ–º –ø–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã:

```python
# (flow, callback_after_cancel)
(self.add_invited_flow, lambda ev: self._invited_handler.handle_invited(ev, ...))
(self.add_permanent_invited_flow, lambda ev: self._participants_handler.handle_participants(ev, ...))
```

### 7. Singleton (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

**–§–∞–π–ª:** `config.py`

–ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä `config = Config()` ‚Äî dataclass, –∑–∞–≥—Ä—É–∂–∞—é—â–∏–π –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `.env` –∏ `meeting_settings.yml`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ –≤—Å–µ–º—É –ø—Ä–æ–µ–∫—Ç—É —á–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç.

### 8. Observer (SSE)

**–§–∞–π–ª—ã:** `modules/core/sse_handler.py`, `modules/core/app.py`

`SSEHandler` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ SSE-–ø–æ—Ç–æ–∫—É KChat –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º daemon-–ø–æ—Ç–æ–∫–µ. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `on_message(data)` callback, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ `MeetingService.process_sse_event()`.

---

## –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π

### `main.py` ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, —Å–æ–∑–¥–∞—ë—Ç –ë–î, —Å–æ–∑–¥–∞—ë—Ç `MeetingHandler` –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –µ–≥–æ –º–µ—Ç–æ–¥—ã (`handle_message`, `handle_callback`, `handle_sse_event`) –≤ `BotApp`. –ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞.

### `config.py` ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

Dataclass `Config` —Å –ø–æ–ª—è–º–∏ –∏–∑ `.env` (—á–µ—Ä–µ–∑ `python-dotenv`). –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏–∑ `config/meeting_settings.yml` (PyYAML). –°–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: —Ç–æ–∫–µ–Ω –±–æ—Ç–∞, URLs API/SSE, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, SMTP, –ø–∞–≥–∏–Ω–∞—Ü–∏—è.

### `modules/core/app.py` ‚Äî BotApp

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `messenger_bot_api.Application`, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
1. `ClickButtonEventHandler` (callback-–∫–Ω–æ–ø–∫–∏) ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º, —á—Ç–æ–±—ã –∫–ª–∏–∫–∏ –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–ª–∏—Å—å `MessageHandler`.
2. `MessageHandler` (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è).
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç `SSEHandler` –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ.
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç `HealthCheckResponder` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

### `modules/core/sse_handler.py` ‚Äî SSEHandler

–î–µ—Ä–∂–∏—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ SSE-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ KChat. –ü—Ä–∏ –æ–±—Ä—ã–≤–µ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π. –ü–∞—Ä—Å–∏—Ç `data:` —Å—Ç—Ä–æ–∫–∏ –≤ JSON –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç callback.

### `modules/core/health_check_responder.py` ‚Äî HealthCheckResponder

–û—Ç–¥–µ–ª—å–Ω—ã–π SSE-–ø–æ—Ç–æ–∫, —Å–ª—É—à–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è `Health check [CODE]`, –æ—Ç–≤–µ—á–∞–µ—Ç —ç—Ö–æ `‚úÖ Health check [CODE] OK` –∏ —É–¥–∞–ª—è–µ—Ç –æ–±–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ API. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (cron, Docker HEALTHCHECK).

### `modules/meeting/handler.py` ‚Äî MeetingHandler (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å (~ 1160 —Å—Ç—Ä–æ–∫). –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî —Å–æ–∑–¥–∞—ë—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `MeetingService`, flow-–æ–±—ä–µ–∫—Ç—ã, `UserContextStore`, `CommandResolver`, `CommandDispatcher`, `InvitedHandler`, `ParticipantsHandler`.
2. **`handle_message(event)`** ‚Äî –≥–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î.
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.
   - –í—ã–∑—ã–≤–∞–µ—Ç `CommandResolver.resolve()` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã.
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ flow (–ø–æ—à–∞–≥–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏).
   - –î–µ–ª–µ–≥–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—É —á–µ—Ä–µ–∑ `CommandDispatcher.dispatch()`.
3. **`handle_callback(event)`** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ inline-–∫–Ω–æ–ø–∫–∞–º (–≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ, —Ñ–∏–ª—å—Ç—Ä—ã, –¥–µ–π—Å—Ç–≤–∏—è —Å –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–º–∏/—É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏).
4. **`handle_sse_event(event_data)`** ‚Äî –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç SSE-–¥–∞–Ω–Ω—ã–µ –≤ `MeetingService`.

### `modules/meeting/command_resolver.py` ‚Äî CommandResolver

–°–ª–æ–≤–∞—Ä—å `COMMANDS` –¥–ª—è –ø—Ä—è–º—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (`/–ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ` ‚Üí `"invited"`) –∏ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥:
- `/—É—á–∞—Å—Ç–Ω–∏–∫–∏N` ‚Üí `"participants_page"` (regex).
- `/N` ‚Üí `"invited_page"` –∏–ª–∏ `"participants_page"` (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞).
- `/–≤—Å–µ` ‚Üí `"invited_all"` –∏–ª–∏ `"participants_all"` (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞).

### `modules/meeting/command_dispatcher.py` ‚Äî CommandDispatcher

–ü—Ä–æ—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ `dict[str, Callable]` —Å –º–µ—Ç–æ–¥–∞–º–∏ `register()` –∏ `dispatch()`. –ó–∞–º–µ–Ω—è–µ—Ç –¥–ª–∏–Ω–Ω—É—é —Ü–µ–ø–æ—á–∫—É `if/elif`.

### `modules/meeting/user_context.py` ‚Äî UserContextStore

–•—Ä–∞–Ω–∏—Ç –¥–≤–∞ —Å–ª–æ–≤–∞—Ä—è –ø–æ `sender_id`:
- `_filter_context` ‚Äî –∫–∞–∫–æ–π —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–µ–Ω.
- `_participants_context` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.

–ú–µ—Ç–æ–¥—ã: `switch_to_participants()`, `switch_to_invited_list()`, `switch_to_invited_with_filter()`, `switch_to_invited_all()`, `reset_participants_for_page()`.

### `modules/meeting/invited_handler.py` ‚Äî InvitedHandler

–í—Å—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –Ω–∞ —Å–æ–±—Ä–∞–Ω–∏–µ:
- `handle_invited(event, ...)` ‚Äî –ø–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏.
- `format_list_paginated(invited_list, page)` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º.
- `get_buttons(...)` ‚Äî inline-–∫–Ω–æ–ø–∫–∏ (–î–æ–±–∞–≤–∏—Ç—å, –£–¥–∞–ª–∏—Ç—å, –ü–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä—ã).
- `handle_add()`, `handle_delete()`, `handle_search()` ‚Äî –∑–∞–ø—É—Å–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö flow.

### `modules/meeting/participants_handler.py` ‚Äî ParticipantsHandler

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:
- `handle_participants(event, ...)` ‚Äî –ø–æ–∫–∞–∑, –ø–∞–≥–∏–Ω–∞—Ü–∏—è, –ø–∞—Ä—Å–∏–Ω–≥ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–ø–∏—Å–∫–∞.
- `get_buttons(...)` ‚Äî inline-–∫–Ω–æ–ø–∫–∏.
- `handle_add()`, `handle_delete()`, `handle_search()` ‚Äî –∑–∞–ø—É—Å–∫ flow.

### `modules/meeting/invited_parser.py` ‚Äî –ü–∞—Ä—Å–µ—Ä —Å–ø–∏—Å–∫–æ–≤

–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö:
- `_split_line(line)` ‚Äî —Ä–∞–∑–±–∏–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏ –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—é (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `' | '` ‚Üí `'|'` ‚Üí `';'`).
- `parse_invited_line(line)` ‚Üí `{full_name, email, phone}` –∏–ª–∏ `None`.
- `validate_invited_row(row)` ‚Üí `(is_valid, error)`.
- `parse_invited_list(text)` ‚Üí `list[dict]` ‚Äî –ø–∞—Ä—Å–∏—Ç –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç.

### `modules/meeting/service.py` ‚Äî MeetingService

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å—Ä–µ–¥–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è:
- `check_user_allowed(event)` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—à—ë–Ω.
- `sync_user_to_users_table(event)` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î.
- `get_meeting_info()` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º —Å–æ–±—Ä–∞–Ω–∏–∏.
- `get_user_email(event)` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ –ë–î –∏–ª–∏ API).
- `process_sse_event(event_data)` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ SSE-—Å–æ–±—ã—Ç–∏–π.
- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: `_build_full_name()`, `_merge_user_data()`, `_normalize_job_title()`.

### `modules/meeting/meeting_repository.py` ‚Äî MeetingRepository

CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î:
- –°–æ–±—Ä–∞–Ω–∏—è: `create_new_meeting()`, `get_active_meeting()`, `update_meeting()`, `delete_meeting()`.
- –ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ: `add_invited()`, `get_invited_list()`, `delete_invited()`, `search_invited()`, `copy_invited_to_meeting()`.
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏: `save_permanent_invited()`, `get_permanent_invited_list()`, `delete_permanent_invited()`, `search_permanent_invited()`.
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã: `is_admin()`, `get_admin_by_email()`.
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ (`_normalize_phone()`).

### `modules/meeting/config_manager.py` ‚Äî MeetingConfigManager

–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ `config/meeting.json`. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- `get_message(key)` ‚Äî —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
- `get_button(key)` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏.
- `get_all_buttons()` ‚Äî –≤—Å–µ –∫–Ω–æ–ø–∫–∏.
- `get_invited_per_page()` ‚Äî —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.

### `modules/meeting/validators.py` ‚Äî –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã

- `validate_meeting_date(value)` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã (—Ñ–æ—Ä–º–∞—Ç, –Ω–µ –≤ –ø—Ä–æ—à–ª–æ–º, –Ω–µ –¥–∞–ª—å—à–µ 30 –¥–Ω–µ–π).
- `validate_meeting_time(value)` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ (–≥–∏–±–∫–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏).

### `modules/meeting/schedule_utils.py` ‚Äî –£—Ç–∏–ª–∏—Ç—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

- `calculate_next_meeting_date(schedule)` ‚Äî –≤—ã—á–∏—Å–ª—è–µ—Ç –±–ª–∏–∂–∞–π—à—É—é –¥–∞—Ç—É —Å–æ–±—Ä–∞–Ω–∏—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (weekly/daily).
- `format_date_for_meeting(dt)` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `datetime` –≤ `(DD.MM.YYYY, HH:MM)`.

### `modules/meeting/*_flow.py` ‚Äî –ü–æ—à–∞–≥–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏

–ö–∞–∂–¥—ã–π flow —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ –∫–ª—é—á—É `(sender_id, group_id, workspace_id)`:

| Flow | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `CreateMeetingFlow` | –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–∏—è (—Ç–µ–º–∞ ‚Üí –¥–∞—Ç–∞ ‚Üí –≤—Ä–µ–º—è ‚Üí –º–µ—Å—Ç–æ ‚Üí —Å—Å—ã–ª–∫–∞) |
| `EditMeetingFlow` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/–ø–µ—Ä–µ–Ω–æ—Å —Å–æ–±—Ä–∞–Ω–∏—è |
| `AddInvitedFlow` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–º |
| `EditDeleteInvitedFlow` | –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω–æ–≥–æ |
| `SearchInvitedFlow` | –ü–æ–∏—Å–∫ –ø–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–º |
| `AddPermanentInvitedFlow` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
| `EditDeletePermanentInvitedFlow` | –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| `SearchPermanentInvitedFlow` | –ü–æ–∏—Å–∫ –ø–æ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º |

---

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–∏—è (admin)

```
/—Å–æ–∑–¥–∞—Ç—å_—Å–æ–±—Ä–∞–Ω–∏–µ ‚Üí CommandResolver ‚Üí CommandDispatcher
  ‚Üí CreateMeetingFlow.start()
  ‚Üí –ø–æ—à–∞–≥–æ–≤—ã–π –≤–≤–æ–¥: —Ç–µ–º–∞ ‚Üí –¥–∞—Ç–∞ ‚Üí –≤—Ä–µ–º—è ‚Üí –º–µ—Å—Ç–æ ‚Üí —Å—Å—ã–ª–∫–∞
  ‚Üí MeetingRepository.create_new_meeting()
  ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ permanent_invited ‚Üí invited
```

### –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ (–ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π)

```
/start ‚Üí MeetingHandler._handle_start()
  ‚Üí MeetingService.check_user_allowed() ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ invited
  ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏ (–î–∞ / –ù–µ—Ç / ...)
  ‚Üí handle_callback() ‚Üí MeetingStorage.save_answer()
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö (admin)

```
/–ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ ‚Üí CommandResolver("invited")
  ‚Üí CommandDispatcher ‚Üí _cmd_invited()
  ‚Üí UserContextStore.switch_to_invited_list()
  ‚Üí InvitedHandler.handle_invited()
  ‚Üí MeetingRepository.get_invited_list()
  ‚Üí –ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä—ã, –∫–Ω–æ–ø–∫–∏ ‚Üí reply
```

### –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

```
/–ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ      ‚Üí –∫–æ–Ω—Ç–µ–∫—Å—Ç = invited
  /2               ‚Üí CommandResolver –≤–∏–¥–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç invited ‚Üí "invited_page"
  /–Ω–µ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏    ‚Üí —Ñ–∏–ª—å—Ç—Ä "not_voted"
  /–≤—Å–µ             ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö

/—É—á–∞—Å—Ç–Ω–∏–∫–∏         ‚Üí –∫–æ–Ω—Ç–µ–∫—Å—Ç = participants
  /2               ‚Üí CommandResolver –≤–∏–¥–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç participants ‚Üí "participants_page"
  /–≤—Å–µ             ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª–∏ (SQLAlchemy 2.0 Mapped style)

| –ú–æ–¥–µ–ª—å | –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|---------|-----------|
| `User` | `users` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –Ω–∞—á–∞–≤—à–∏–µ —á–∞—Ç —Å –±–æ—Ç–æ–º. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: `(sender_id, group_id, workspace_id)` |
| `Meeting` | `meetings` | –°–æ–±—Ä–∞–Ω–∏—è (—Ç–µ–º–∞, –¥–∞—Ç–∞, –≤—Ä–µ–º—è, –º–µ—Å—Ç–æ, —Å—Å—ã–ª–∫–∞) |
| `MeetingAdmin` | `meeting_admins` | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (email, –§–ò–û). –û–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—Ä–∞–Ω–∏–π |
| `PermanentInvited` | `permanent_invited` | –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (–§–ò–û, email, —Ç–µ–ª–µ—Ñ–æ–Ω). –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ email |
| `Invited` | `invited` | –ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–±—Ä–∞–Ω–∏–µ. FK ‚Üí `meetings.id`. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: `(meeting_id, email)`. –•—Ä–∞–Ω–∏—Ç –æ—Ç–≤–µ—Ç (`answer`) –∏ —Å—Ç–∞—Ç—É—Å—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |

–í—Å–µ –º–æ–¥–µ–ª–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç `BaseModel` —Å –ø–æ–ª—è–º–∏ `id`, `created_at`, `updated_at`.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏

- `get_session_context()` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `commit` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ, `rollback` –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏.
- `get_engine()` ‚Äî singleton SQLAlchemy engine —Å `pool_pre_ping`.
- `init_db()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —á–µ—Ä–µ–∑ `Base.metadata.create_all()`.
- –ú–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî —á–µ—Ä–µ–∑ Alembic (`alembic upgrade head`).

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–∑–Ω–∏ –±–æ—Ç–∞ (Health Check)

–°–∫—Ä–∏–ø—Ç `tools/bot_health_check.py` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –∏ –æ–∂–∏–¥–∞–µ—Ç —ç—Ö–æ. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env`:

```ini
BOT_TOKEN=...
API_BASE_URL=https://api.kchat.app
SSE_BASE_URL=https://pusher.kchat.app
HEALTH_CHECK_GROUP_ID=123
HEALTH_CHECK_TIMEOUT=10
```

```bash
uv run python tools/bot_health_check.py          # —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥
uv run python tools/bot_health_check.py -v        # –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
uv run python tools/bot_health_check.py -q        # —Ç–∏—Ö–∏–π —Ä–µ–∂–∏–º –¥–ª—è cron/Docker
```

**–ö–æ–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞:** 0 ‚Äî OK, 1 ‚Äî –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, 2 ‚Äî –æ—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

`HealthCheckResponder` –≤ `modules/core/` —Å–ª—É—à–∞–µ—Ç SSE –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ, –æ—Ç–≤–µ—á–∞–µ—Ç —ç—Ö–æ –∏ —É–¥–∞–ª—è–µ—Ç –æ–±–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã —á–∞—Ç–∞.

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
